% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{plot_simulation_on_landscape}
\alias{plot_simulation_on_landscape}
\title{Visualize Simulation Results Overlaid on Landscape}
\usage{
plot_simulation_on_landscape(
  simulation_result,
  point_size = 2,
  point_color = "red",
  point_shape = 16,
  color_by = "none",
  landscape_colors = "habitat",
  main = NULL,
  filename = NULL,
  add_stats = TRUE
)
}
\arguments{
\item{simulation_result}{A 'twolife_result' object from \code{\link{twolife_simulation}}.}

\item{point_size}{Numeric. Size of points representing surviving individuals in the plot.}

\item{point_color}{Character. Color for points when color_by="none". Any valid R color name or hex code.}

\item{point_shape}{Integer. Point shape following R's pch codes (16 = filled circle, 1 = open circle, 17 = filled triangle).}

\item{color_by}{Character. Trait used to color survivor points:
\itemize{
  \item "none" - Single color specified by point_color
  \item "genotype" - Color gradient based on genotype values (heat colors)
  \item "phenotype" - Color gradient based on phenotype values (heat colors)
}}

\item{landscape_colors}{Character. Color scheme for landscape background:
\itemize{
  \item "habitat" - Green gradient (white = matrix, dark green = high-quality habitat). Best for binary landscapes.
  \item "terrain" - Built-in terrain.colors palette (green-brown-white). General-purpose visualization.
  \item "viridis" - Viridis color scale (requires viridisLite package). Perceptually uniform and colorblind-friendly.
}}

\item{main}{Character. Plot title. If NULL, automatically generates title showing final time and population size.}

\item{filename}{Character. Optional file path to save plot. If NULL, displays interactively.}

\item{add_stats}{Logical. If TRUE, adds statistics text to plot (currently not implemented).}
}
\value{
The input simulation_result object, invisibly. Allows for piping/chaining operations.
}
\description{
Creates a comprehensive visualization showing the spatial distribution of
surviving individuals on the habitat landscape. Displays habitat values
as background colors with survivors as colored points, enabling assessment
of habitat selection, spatial clustering, and genotype-environment matching.
}
\details{
## Visualization Components

1. **Background Layer**: Landscape habitat values
   \itemize{
     \item Color intensity represents habitat values
     \item Binary: white (matrix) vs green (habitat)
     \item Continuous: gradient from low to high values
   }

2. **Foreground Layer**: Surviving individuals
   \itemize{
     \item Each point represents one individual at final position
     \item Point color represents trait value (genotype or phenotype)
     \item Point size controlled by point_size parameter
   }

3. **Coordinate System**:
   \itemize{
     \item X-axis: Horizontal world coordinates (centered at 0)
     \item Y-axis: Vertical world coordinates (centered at 0)
     \item Range: \eqn{\pm \text{world\_dimension}/2}
     \item Grid overlay marks cell boundaries
   }

## Interpretation Guidelines

**Spatial Pattern Analysis:**
\itemize{
  \item **Clustered survivors**: Suggests habitat selection or density-dependent processes
  \item **Even distribution**: May indicate weak habitat selection or high dispersal
  \item **Edge concentration**: Possible boundary condition effects or edge habitat preference
  \item **Patch occupancy**: Compare survivor locations to habitat patches in binary landscapes
}

**Genotype-Environment Matching:**

When \code{color_by = "genotype"}:
\itemize{
  \item **Matching colors**: Point color similar to background → good habitat matching
  \item **Contrasting colors**: Point color differs from background → potential mismatch
  \item **Gradient tracking**: Points follow habitat gradient → successful adaptation
  \item **Spatial sorting**: Different genotypes in different patches → local adaptation
}

Visual pattern interpretation depends on:
\deqn{\text{Matching Quality} \propto \frac{\text{sampling\_points} \times (1 - \text{genotype\_sds})}{\text{habitat\_selection\_temperatures}}}

Strong matching expected with:
\itemize{
  \item High sampling_points (informed habitat choice)
  \item Low genotype_sds (narrow niches, specialists)
  \item Low habitat_selection_temperatures (deterministic selection)
  \item High mutation_rates (genetic variation for adaptation)
}

**Phenotype vs Genotype:**

When plasticity > 0:
\itemize{
  \item \code{color_by = "genotype"}: Shows inherited genetic values
  \item \code{color_by = "phenotype"}: Shows expressed traits (genotype + plastic response)
  \item Phenotypes typically show stronger habitat matching than genotypes
  \item Difference reveals plastic response magnitude
}

## Color Palette Selection

\tabular{lll}{
  \strong{Palette} \tab \strong{Best For} \tab \strong{Interpretation} \cr
  "habitat" \tab Binary landscapes \tab Clear habitat/matrix distinction \cr
  "terrain" \tab General use \tab Traditional landscape colors \cr
  "viridis" \tab Continuous gradients \tab Accurate gradient perception \cr
}

For publications:
\itemize{
  \item Use "viridis" for colorblind accessibility
  \item Match color scheme to manuscript style guidelines
  \item Consider grayscale conversion for print journals
}
}
\examples{
set.seed(200)
landscape <- create_fractal_landscape(
  cells_per_row = 10,
  fractality = 0.5,
  min_value = 0,
  max_value = 1,
  return_as_landscape_params = TRUE
)

set.seed(400)
result <- twolife_simulation(
  landscape_params = landscape,
  individual_params = list(
    initial_population_size = 50,
    base_birth_rate = 0.5,
    base_mortality_rate = 0.2,
    matrix_mortality_multiplier = 3.0
  ),
  genetic_params = list(
    genotype_means = runif(50, min = 0, max = 1),
    genotype_sds = 0.5,
    sampling_points = 10,
    habitat_selection_temperatures = 0.1
  ),
  simulation_params = list(max_events = 100)
)

# Basic plot (default: colored by phenotype)
plot_simulation_on_landscape(result)

# Customize title and color by phenotype
plot_simulation_on_landscape(
  result,
  main = "Survivors Colored by Phenotype",
  color_by = "phenotype"
)

# Color by genotype
plot_simulation_on_landscape(
  result,
  main = "Survivors Colored by Genotype",
  color_by = "genotype"
)

# Customize point size
plot_simulation_on_landscape(
  result,
  main = "Large Points",
  color_by = "phenotype",
  point_size = 3
)
}
\seealso{
\code{\link{twolife_simulation}} for running simulations,
  \code{\link{plot_landscape}} for landscape visualization,
  \code{\link{snapshot_at_time}} for temporal snapshots
}
