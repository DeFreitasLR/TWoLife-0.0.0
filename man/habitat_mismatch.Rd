% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{habitat_mismatch}
\alias{habitat_mismatch}
\title{Calculate Genotype-Habitat Fitness Statistics}
\usage{
habitat_mismatch(simulation_result, return_individuals = FALSE)
}
\arguments{
\item{simulation_result}{A 'twolife_result' object from \code{\link{twolife_simulation}}}

\item{return_individuals}{Logical. If TRUE, includes individual-level data in output.}
}
\value{
A list of class 'genotype_habitat_mismatch' with components:
  \describe{
    \item{n_survivors}{Integer. Number of surviving individuals analyzed}
    \item{mean_fitness}{Numeric. Mean fitness across all survivors (0-1 scale)}
    \item{median_fitness}{Numeric. Median fitness}
    \item{sd_fitness}{Numeric. Standard deviation of fitness}
    \item{min_fitness}{Numeric. Minimum fitness value}
    \item{max_fitness}{Numeric. Maximum fitness value}
    \item{high_fitness_count}{Integer. Number with fitness > 0.8}
    \item{medium_fitness_count}{Integer. Number with fitness 0.5-0.8}
    \item{low_fitness_count}{Integer. Number with fitness < 0.5}
    \item{percent_high_fitness}{Numeric. Percentage with fitness > 0.8}
    \item{percent_medium_fitness}{Numeric. Percentage with fitness 0.5-0.8}
    \item{percent_low_fitness}{Numeric. Percentage with fitness < 0.5}
    \item{correlation}{Numeric. Pearson correlation between phenotype and habitat (-1 to 1)}
    \item{mean_genotype}{Numeric. Mean genotype value of survivors}
    \item{sd_genotype}{Numeric. Standard deviation of genotype}
    \item{mean_phenotype}{Numeric. Mean phenotype value of survivors}
    \item{sd_phenotype}{Numeric. Standard deviation of phenotype}
    \item{mean_habitat}{Numeric. Mean habitat value at survivor locations}
    \item{sd_habitat}{Numeric. Standard deviation of habitat at survivor locations}
    \item{mean_niche_width}{Numeric. Mean niche width (genotype_sds) of survivors}
    \item{sd_niche_width}{Numeric. Standard deviation of niche width}
    \item{mean_absolute_mismatch}{Numeric. Mean |phenotype - habitat|}
    \item{median_absolute_mismatch}{Numeric. Median |phenotype - habitat|}
    \item{individuals}{Data frame with per-individual data (only if return_individuals=TRUE).
      Contains columns: id, x, y, genotype, phenotype, width, habitat_value, fitness,
      absolute_mismatch, raw_mismatch, row_index, col_index}
  }

  The object has a custom print method that displays formatted statistics.
}
\description{
Computes fitness-based metrics quantifying how well surviving individuals match their
habitat. Calculates fitness using the same Gaussian function used during the simulation,
providing comprehensive statistics on habitat matching quality and population fitness.
}
\details{
Fitness Calculation:
  This function uses the same fitness formula that determines demographic rates during
  the simulation. Fitness quantifies how well an individual's phenotype matches the
  habitat value at its location.

  For Gaussian fitness individuals (niche_width > 0):

  \deqn{f = \exp\left(-\frac{(p - h)^2}{2\sigma^2}\right)}

  Where:
  \itemize{
    \item \eqn{f} = fitness (ranges 0 to 1)
    \item \eqn{p} = phenotype (individual's expressed trait value)
    \item \eqn{h} = habitat value at individual's location (0 to 1)
    \item \eqn{\sigma} = niche_width (genotype_sds parameter, tolerance to mismatch)
  }

  For perfect specialists (niche_width = 0):

  \deqn{f = \begin{cases} 
  1 & \text{if } |p - h| < \epsilon \\
  0 & \text{otherwise}
  \end{cases}}

  Where \eqn{\epsilon = 0.001} is the tolerance threshold.

  This binary fitness function means specialists only survive in exactly matching habitat.

Fitness Interpretation:
  \itemize{
    \item fitness = 1.0: Perfect match. Phenotype exactly equals habitat value.
    \item fitness > 0.8: High fitness. Within ~1 niche width of optimum.
    \item fitness = 0.5-0.8: Medium fitness. 1-2 niche widths from optimum.
    \item fitness < 0.5: Low fitness. More than 2 niche widths from optimum.
    \item fitness = 0.368 (1/e): Exactly 1 niche width from optimum (Gaussian inflection point).
  }

Connection to Simulation Demography:
  NOTE: This function reports normalized fitness (0-1 scale) for interpretability, but the
  simulation uses the probability density function for mortality. During simulation, mortality for Gaussian fitness individuals is:

  \deqn{\mu = \mu_{max} - W(\mu_{max} - \mu_{min})}

  Where \eqn{W = \frac{1}{\sigma\sqrt{2\pi}} \exp(-\frac{(h-p)^2}{2\sigma^2})} is the
  probability density. At optimal habitat, perfect specialists (narrow \eqn{\sigma = 0}) achieve maximum fitness
  and thus lower mortality than individuals with broader niche widths, creating the "jack of all trades, master of none" tradeoff.
}
\examples{
set.seed(200)
landscape <- create_fractal_landscape(
  cells_per_row = 10,
  fractality = 0.5,
  min_value = 0,
  max_value = 1,
  return_as_landscape_params = TRUE
)

set.seed(400)
result <- twolife_simulation(
  landscape_params = landscape,
  individual_params = list(
    initial_population_size = 50,
    base_birth_rate = 0.5,
    base_mortality_rate = 0.2,
    matrix_mortality_multiplier = 3.0
  ),
  genetic_params = list(
    genotype_means = runif(50, min = 0, max = 1),
    genotype_sds = 0.5,
    sampling_points = 10,
    habitat_selection_temperatures = 0.1
  ),
  simulation_params = list(max_events = 100)
)

# Calculate fitness metrics
mismatch <- habitat_mismatch(result)
print(mismatch)

# Get individual-level data
mismatch_detailed <- habitat_mismatch(result, return_individuals = TRUE)
head(mismatch_detailed$individuals)
}
\seealso{
\code{\link{check_habitat_match}} for visual validation
}
