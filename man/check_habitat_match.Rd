% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{check_habitat_match}
\alias{check_habitat_match}
\title{Validate Habitat Matching for Simulation Results}
\usage{
check_habitat_match(
  simulation_result,
  main = NULL,
  point_size = 2,
  landscape_colors = "terrain",
  color_by = "phenotype",
  show_stats = TRUE,
  show_legend = TRUE
)
}
\arguments{
\item{simulation_result}{A 'twolife_result' object from \code{\link{twolife_simulation}}}

\item{main}{Character. Plot title. If NULL, automatically generated.}

\item{point_size}{Numeric. Size of points in scatter plot.}

\item{landscape_colors}{Character. Color scheme for landscape background.
Options: "habitat", "terrain", "viridis". Note: Binary landscapes (habitat
values of 0 and 1 only) automatically use the "habitat" color scheme
(0 = white matrix, 1 = green habitat) regardless of this parameter, ensuring
consistent visual interpretation.}

\item{color_by}{Character. Which trait to analyze:
\itemize{
  \item "genotype" - Analyze genotype-habitat matching
  \item "phenotype" - Analyze phenotype-habitat matching (recommended for plasticity)
}}

\item{show_stats}{Logical. If TRUE, prints statistical summary to console.}

\item{show_legend}{Logical. If TRUE, displays color legend on plot.}
}
\value{
Invisibly returns a data frame with columns:
  \describe{
    \item{id}{Integer. Individual ID}
    \item{x}{Numeric. X coordinate in world space}
    \item{y}{Numeric. Y coordinate in world space}
    \item{genotype}{Numeric. Genotype value}
    \item{phenotype}{Numeric. Phenotype value}
    \item{habitat_value}{Numeric. Habitat value at individual's location}
    \item{row_index}{Integer. Landscape row index (for debugging)}
    \item{col_index}{Integer. Landscape column index (for debugging)}
  }
}
\description{
Creates side-by-side visualizations to assess whether surviving individuals are positioned
in habitat matching their genotype or phenotype values. The left plot displays the
landscape with habitat values, while the right plot shows survivor locations
colored by their trait values. Calculates correlation between individual trait values
and habitat environmental values to quantify effectiveness of habitat selection or adaptation.
}
\details{
What This Function Measures:
  This function tests whether individuals are found in habitats matching their trait
  values. Perfect matching would show:
  \itemize{
    \item Individuals with trait value 0.8 in habitats with values ~0.8
    \item Individuals with trait value 0.2 in habitats with values ~0.2
    \item Strong positive correlation (r close to 1.0)
  }

Mathematical Basis:
  Calculates Pearson correlation coefficient:

  \deqn{r = \frac{\text{Cov}(X, H)}{\sigma_X \sigma_H}}

  Where:
  \itemize{
    \item \eqn{X} = trait values (genotype or phenotype) of survivors
    \item \eqn{H} = habitat values at survivor locations
    \item \eqn{\sigma_X}, \eqn{\sigma_H} = standard deviations
    \item \eqn{r} ranges from -1 (perfect negative) to +1 (perfect positive correlation)
  }

  Also provides Spearman rank correlation (robust to outliers and non-linear relationships).

Visualization Components:
  Creates a two-panel plot:

  Left panel - Landscape visualization:
  \itemize{
    \item Displays the spatial landscape with habitat values as background colors
    \item X and Y axes show world coordinates
    \item Color intensity represents habitat values (darker/greener = higher values)
    \item Binary landscapes (0/1 values): white = matrix, green = habitat
    \item Continuous landscapes: color gradient shows habitat values variation
  }

  Right panel - Survivor distribution:
  \itemize{
    \item Shows coordinates of all surviving individuals as points
    \item Each point represents one survivor's position
    \item Point color represents the individual's trait value (genotype or phenotype)
    \item Color mapping matches landscape color scheme for visual comparison
    \item Good matching: point colors should match the background colors in left panel
    \item Poor matching: points show colors different from their corresponding landscape locations
  }

Connection to Simulation Parameters:
  Correlation strength depends on:
  \itemize{
    \item sampling_points: Higher values enable better habitat selection (stronger r)
    \item habitat_selection_temperatures: Lower values create stronger selection (stronger r)
    \item mutation_rates: Higher values create more trait variation to match habitat variation
    \item genotype_sds: Niche width - narrower niches (lower values) favor stronger matching
    \item simulation duration: Longer simulations allow more adaptation (stronger r over time)
  }

Statistical Output:
  When show_stats = TRUE, prints to console:
  \itemize{
    \item Sample size (number of survivors)
    \item Pearson correlation with p-value (tests H0: r = 0)
    \item Spearman rank correlation (non-parametric alternative)
    \item Mean and range of trait values
    \item Mean and range of habitat values at survivor locations
  }
}
\examples{
\donttest{
# Simulation without habitat selection — binary landscape, no genetics
set.seed(100)
binary_landscape <- create_fractal_landscape(
  cells_per_row      = 5,
  fractality         = 0.5,
  habitat_proportion = 0.4
)
result_no_selection <- twolife_simulation(
  landscape_params = list(
    habitat                     = binary_landscape,
    cell_size                   = 1.0,
    boundary_condition          = 1,
    density_type                = 1,
    matrix_mortality_multiplier = 2.0,
    matrix_dispersal_multiplier = 0.5
  ),
  individual_params = list(
    initial_population_size = 1000,
    neighbor_radius         = 2.0,
    vision_angle            = pi,
    step_length             = 5.0,
    base_dispersal_rate     = 0.4,
    base_birth_rate         = 0.6,
    base_mortality_rate     = 0.2,
    birth_density_slope     = 0.02,
    mortality_density_slope = 0.02
  ),
  simulation_params = list(max_events = 100),
  master_seed = 45
)

# Simulation with habitat selection — Scenario 5
set.seed(50)
continuous_landscape <- create_fractal_landscape(
  cells_per_row = 5,
  fractality    = 0.5,
  min_value     = 0.0,
  max_value     = 100.0
)
initial_pop_size  <- 1000
initial_genotypes <- seq(0, 100, length.out = initial_pop_size)
result_with_selection <- twolife_simulation(
  landscape_params = list(
    habitat                     = continuous_landscape,
    cell_size                   = 1.0,
    boundary_condition          = 1,
    density_type                = 1,
    matrix_mortality_multiplier = 2.0,
    matrix_dispersal_multiplier = 0.5
  ),
  individual_params = list(
    initial_population_size = initial_pop_size,
    neighbor_radius         = 2.0,
    vision_angle            = pi,
    step_length             = 5.0,
    base_dispersal_rate     = 0.4,
    base_birth_rate         = 0.6,
    base_mortality_rate     = 0.2,
    birth_density_slope     = 0.02,
    mortality_density_slope = 0.02
  ),
  genetic_params = list(
    genotype_means                 = initial_genotypes,
    genotype_sds                   = rep(0.4,   initial_pop_size),
    mutation_rates                 = rep(0.001, initial_pop_size),
    plasticities                   = rep(0.001, initial_pop_size),
    sampling_points                = rep(10,    initial_pop_size),
    habitat_selection_temperatures = rep(0.1,   initial_pop_size)
  ),
  simulation_params = list(max_events = 100),
  master_seed = 49
)

# Compare habitat matching
check_habitat_match(result_no_selection,   color_by = "phenotype")
check_habitat_match(result_with_selection, color_by = "phenotype")

# Check by genotype
check_habitat_match(result_with_selection, color_by = "genotype")
}
}
\seealso{
\code{\link{habitat_mismatch}} for fitness-based analysis
}
