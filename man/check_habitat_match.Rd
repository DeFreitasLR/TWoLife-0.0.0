% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{check_habitat_match}
\alias{check_habitat_match}
\title{Validate Habitat Matching for Simulation Results}
\usage{
check_habitat_match(
  simulation_result,
  main = NULL,
  point_size = 2,
  landscape_colors = "terrain",
  color_by = "phenotype",
  show_stats = TRUE,
  show_legend = TRUE
)
}
\arguments{
\item{simulation_result}{A 'twolife_result' object from \code{\link{twolife_simulation}}}

\item{main}{Character. Plot title. If NULL, automatically generated.}

\item{point_size}{Numeric. Size of points in scatter plot.}

\item{landscape_colors}{Character. Color scheme for landscape background.
Options: "habitat", "terrain", "viridis". Note: Binary landscapes (habitat
values of 0 and 1 only) automatically use the "habitat" color scheme
(0 = white matrix, 1 = green habitat) regardless of this parameter, ensuring
consistent visual interpretation.}

\item{color_by}{Character. Which trait to analyze:
\itemize{
  \item "genotype" - Analyze genotype-habitat matching
  \item "phenotype" - Analyze phenotype-habitat matching (recommended for plasticity)
}}

\item{show_stats}{Logical. If TRUE, prints statistical summary to console.}

\item{show_legend}{Logical. If TRUE, displays color legend on plot.}
}
\value{
Invisibly returns a data frame with columns:
  \describe{
    \item{id}{Integer. Individual ID}
    \item{x}{Numeric. X coordinate in world space}
    \item{y}{Numeric. Y coordinate in world space}
    \item{genotype}{Numeric. Genotype value}
    \item{phenotype}{Numeric. Phenotype value}
    \item{habitat_value}{Numeric. Habitat quality at individual's location}
    \item{row_index}{Integer. Landscape row index (for debugging)}
    \item{col_index}{Integer. Landscape column index (for debugging)}
  }
}
\description{
Visualizes and quantifies whether surviving individuals are positioned
in habitat matching their genotype or phenotype values. Calculates
correlation between individual trait values and habitat environmental values to assess
effectiveness of habitat selection or adaptation.
}
\details{
What This Function Measures:
  This function tests whether individuals are found in habitats matching their trait
  values. Perfect matching would show:
  \itemize{
    \item Individuals with trait value 0.8 in habitats with quality ~0.8
    \item Individuals with trait value 0.2 in habitats with quality ~0.2
    \item Strong positive correlation (r close to 1.0)
  }

Mathematical Basis:
  Calculates Pearson correlation coefficient:

  \deqn{r = \frac{\text{Cov}(X, H)}{\sigma_X \sigma_H}}

  Where:
  \itemize{
    \item \eqn{X} = trait values (genotype or phenotype) of survivors
    \item \eqn{H} = habitat quality values at survivor locations
    \item \eqn{\sigma_X}, \eqn{\sigma_H} = standard deviations
    \item \eqn{r} ranges from -1 (perfect negative) to +1 (perfect positive correlation)
  }

  Also provides Spearman rank correlation (robust to outliers and non-linear relationships).

Visualization Components:
  Creates a two-panel plot:

  Left panel - Spatial distribution:
  \itemize{
    \item Shows landscape with habitat quality as background color
    \item Survivor locations as colored points (color = trait value)
    \item Good matching: point colors visually match background colors
    \item Poor matching: points of one color scattered across all background colors
  }

  Right panel - Correlation plot:
  \itemize{
    \item X-axis: habitat value at individual location (0 to 1)
    \item Y-axis: trait value (genotype or phenotype)
    \item Each point = one surviving individual
    \item Best-fit line and Pearson r displayed
    \item Perfect matching would show points along diagonal (r = 1.0)
  }

Connection to Simulation Parameters:
  Correlation strength depends on:
  \itemize{
    \item sampling_points: Higher values enable better habitat selection (stronger r)
    \item habitat_selection_temperatures: Lower values create stronger selection (stronger r)
    \item mutation_rates: Higher values create more trait variation to match habitat variation
    \item genotype_sds: Niche width - narrower niches (lower values) favor stronger matching
    \item simulation duration: Longer simulations allow more adaptation (stronger r over time)
  }

Statistical Output:
  When show_stats = TRUE, prints to console:
  \itemize{
    \item Sample size (number of survivors)
    \item Pearson correlation with p-value (tests H0: r = 0)
    \item Spearman rank correlation (non-parametric alternative)
    \item Mean and range of trait values
    \item Mean and range of habitat values at survivor locations
  }
}
\examples{
set.seed(100)
landscape <- create_fractal_landscape(
  cells_per_row = 5,
  fractality = 0.5,
  habitat_proportion = 0.6,
  return_as_landscape_params = TRUE
)
landscape_genetic <- create_fractal_landscape(
  cells_per_row = 5,
  fractality = 0.5,
  min_value = 0.35,
  max_value = 0.64,
  return_as_landscape_params = TRUE
)
result <- twolife_simulation(
  landscape_params = landscape,
  individual_params = list(
    initial_population_size = 15,
    base_birth_rate = 0.4,
    base_mortality_rate = 0.15
  ),
  simulation_params = list(max_events = 5),
  master_seed = 123
)
result_genetic <- twolife_simulation(
  landscape_params = landscape_genetic,
  individual_params = list(
    initial_population_size = 15,
    base_birth_rate = 0.4,
    base_mortality_rate = 0.15
  ),
  genetic_params = list(
    genotype_means = rnorm(15, mean = 0.5, sd = 0.15),
    genotype_sds = 0.15
  ),
  simulation_params = list(max_events = 5),
  master_seed = 456
)
validation <- check_habitat_match(result)
validation_genetic <- check_habitat_match(result_genetic, color_by = "genotype")
head(validation)
head(validation_genetic)
if (!is.null(validation_genetic) && nrow(validation_genetic) > 0) {
  cor_value <- cor(validation_genetic$genotype, validation_genetic$habitat_value)
  cat("Genotype-habitat correlation:", round(cor_value, 3), "\n")
}
}
\seealso{
\code{\link{habitat_mismatch}} for fitness-based analysis
}
